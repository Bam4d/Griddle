Version: "0.1"
Environment:
  Name: Rataban
  Description: Push the primordial barril into the hole to become immortal.
  Observers:
    Sprite2D:
      TileSize: 24
      BackgroundTile: gvgai/newset/floor6.png
    Block2D:
      TileSize: 24
  Variables:
    - Name: termination
      InitialValue: 0
    - Name: got_cheese
      InitialValue: 0
    - Name: fell_hole
      InitialValue: 0
  Player:
    AvatarObject: avatar # Object to control
  Termination:
    Win:
      #- eq: [cheese:count, 0] # If there is no cheese left
      - eq: [termination, 1] # If there is no cheese left
    Lose:
      - eq: [avatar:count, 0] # If the rat gets killed
  Levels:
    - |
      wwwwwww
      w..hA.w
      w.whw.w
      w...b.w
      whbb.ww
      w..wwww
      wwwwwww
    - |
      wwwwwww
      w...A.w
      w.w.w.w
      w....cw
      w.b...w
      wh....w
      wwwwwww

Actions:

  # Define the move action
  - Name: move
    Behaviours:
      # The agent can move around freely in empty space
      - Src:
          Object: avatar
          Commands:
            - mov: _dest
        Dst:
          Object: _empty

      # Barrel can move into empty space
      - Src:
          Object: box
          Commands:
            - mov: _dest
        Dst:
          Object: [_empty, hole]

      # The agent can push barrels
      - Src:
          Object: avatar
          Commands:
            - mov: _dest
        Dst:
          Object: box
          Commands:
            - cascade: _dest

      # If the rat moves into a hole it suffers a horrible death
      - Src:
          Object: avatar
          Commands:
            - remove: true
            - reward: -1
        Dst:
          Object: hole

      # If the rat gets the cheese it wins in life
      - Src:
          Object: avatar
          Commands:
#            - exec:
#                Delay: 4
#                Action: the_end
            - mov: _dest
        Dst:
          Object: cheese
          Commands:
            - reward: 1
            #- incr: termination
            - exec:
                Action: change
                Delay: 4
                ActionId: 1
            #- remove: true

  - Name: change
    InputMapping:
      Internal: true
      Inputs:
        1:
          Description: "The only action here is to increment the box count"
    Behaviours:
      - Src:
          Object: cheese
          Commands:
            - incr: termination
            - change_to: sub_cheese
        Dst:
          Object: [cheese, avatar]

  - Name: disappear
    InputMapping:
      Internal: true
    Behaviours:
      - Src:
          Object: cheese
        Dst:
          Object: cheese
          Commands:
            - remove: true

Objects:
  - Name: cheese
    Z: 1
    MapCharacter: c
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/slime6.png
      Block2D:
        - Shape: triangle
          Color: [1.0, 1.0, 0.0]
          Scale: 0.5

  - Name: box
    Z: 2
    MapCharacter: b
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/barrel2.png
      Block2D:
        - Shape: square
          Color: [1.0, 0.0, 0.0]
          Scale: 0.5

  - Name: wall
    MapCharacter: w
    Observers:
      Sprite2D:
        - TilingMode: WALL_16
          Image:
            - gvgai/oryx/dirtWall_0.png
            - gvgai/oryx/dirtWall_1.png
            - gvgai/oryx/dirtWall_2.png
            - gvgai/oryx/dirtWall_3.png
            - gvgai/oryx/dirtWall_4.png
            - gvgai/oryx/dirtWall_5.png
            - gvgai/oryx/dirtWall_6.png
            - gvgai/oryx/dirtWall_7.png
            - gvgai/oryx/dirtWall_8.png
            - gvgai/oryx/dirtWall_9.png
            - gvgai/oryx/dirtWall_10.png
            - gvgai/oryx/dirtWall_11.png
            - gvgai/oryx/dirtWall_12.png
            - gvgai/oryx/dirtWall_13.png
            - gvgai/oryx/dirtWall_14.png
            - gvgai/oryx/dirtWall_15.png
      Block2D:
        - Shape: triangle
          Color: [0.6, 0.6, 0.6]
          Scale: 0.9

  - Name: hole
    Z: 1
    MapCharacter: h
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/cspell4.png
      Block2D:
        - Shape: square
          Color: [0.0, 1.0, 0.0]
          Scale: 0.6

  - Name: avatar
    Z: 2
    MapCharacter: A
    Observers:
      Sprite2D:
        - Image: gvgai/oryx/rat1.png
      Block2D:
        - Shape: triangle
          Color: [0.2, 0.2, 0.6]
          Scale: 1.0

  - Name: sub_cheese
    Z: 1
    Observers:
      Sprite2D:
        - Image: gvgai/newset/block1.png
      Block2D:
        - Shape: square
          Color: [0.0, 0.7, 0.0]
          Scale: 0.5